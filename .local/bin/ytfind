#!/usr/bin/env bash
# Check if a keyword is provided
if [ -z "$1" ]; then
  echo "Usage: ytfind <keyword> <URL>"
  exit 1
fi
# Variables
KEYWORD="$1"
URL="$2"
# yt-dlp command
yt-dlp --match-title "(?i)$KEYWORD" \
  -f "bv*[ext=mp4]+ba*[ext=m4a]/bv*+ba*/b[ext=mp4]/b" \
  --no-embed-metadata --no-add-metadata --no-write-info-json --no-embed-info-json --no-write-description \
  --no-warnings --no-mtime --no-part --no-overwrites --no-abort-on-error --rm-cache-dir \
  --no-cookies-from-browser --rm-cache-dir \
  --sponsorblock-mark all --sponsorblock-remove all \
  --embed-thumbnail --convert-thumbnails jpg --ppa "EmbedThumbnail+ffmpeg:-loglevel error -stats" --embed-chapters \
  --embed-thumbnail --embed-metadata --ignore-errors \
  --continue --retries 20 --retry-sleep exp=1:20 \
  --geo-bypass-country US --user-agent "Mozilla/5.0 (X11; Linux x86_64; rv:141.0) Gecko/20100101 Firefox/141.0" \
  --sub-format "ass/srt/best" --write-subs --write-auto-sub --sub-lang "en,fr,ar" --convert-subs srt \
  --downloader "m3u8:native" --concurrent-fragments 5 \
  --prefer-ffmpeg --ppa "FFmpeg:-map_metadata -1" \
  --downloader-args ffmpeg:"-loglevel error -stats" \
  --merge-output-format mp4 --remux-video mp4 \
  --output "$HOME/Videos/$KEYWORD/%(title).70s.%(ext)s" \
  "$URL"
