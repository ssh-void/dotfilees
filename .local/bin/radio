#!/bin/sh

# Fichier contenant les URLs avec commentaires
FILE=~/.config/.urls.txt

# Associe chaque ligne à une URL + commentaire
selection=$(awk '{print $0}' "$FILE" | fzy --lines=8)

# Si rien n'est sélectionné, quitter proprement
[ -z "$selection" ] && exit

# Extrait uniquement l'URL avant le premier espace ou le `#`
url=$(echo "$selection" | cut -d'#' -f1 | awk '{print $1}')

# Lancer mpv
[ -n "$url" ] &&  torsocks mpv --no-config --no-video \
    --af-add="volume=2" \
    --term-osd-bar \
    --vd-lavc-dr=no --vid=no \
    --ytdl-raw-options=format='ba*[ext=m4a]/ba*/b[ext=mp4]/b',geo-bypass-country=FR,user-agent='Mozilla/5.0 (X11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0',downloader-args='ffmpeg:-loglevel error -stats -timeout 10000000 -reconnect 1 -reconnect_streamed 1 -reconnect_delay_max 5',sponsorblock-mark=all,sponsorblock-remove=all \
    --loop=inf \
    --user-agent="Mozilla/5.0 (X11; Linux x86_64; rv:140.0) Gecko/20100101 Firefox/140.0" "$url"
