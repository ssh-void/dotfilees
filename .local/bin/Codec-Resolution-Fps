#!/usr/bin/env bash

for f in *.mp4; do
  # Récupérer les propriétés
  readarray -t props < <(
    ffprobe -v error -select_streams v:0 \
      -show_entries stream=codec_name,width,height,r_frame_rate \
      -of default=noprint_wrappers=1:nokey=1 "$f"
  )
  codec="${props[0]}"
  width="${props[1]}"
  height="${props[2]}"
  fps=$(awk -F'/' '{printf "%.2f", $1/($2?$2:1)}' <<< "${props[3]}")

  # Dossier cible basé sur la combinaison
  dir="${codec}_${width}x${height}_${fps}fps"
  mkdir -p "$dir"
  mv -- "$f" "$dir/"
  echo "Déplacé: $f -> $dir/"
done
