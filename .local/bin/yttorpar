#!/bin/bash

# Vérifie si un fichier est passé en argument
if [ -z "$1" ]; then
  echo "Usage: yttorpar <fichier_liste_urls>"
  exit 1
fi

# Utilise xargs pour exécuter yt-dlp pour chaque URL dans le fichier
xargs -n 1 -P 20 yt-dlp --proxy socks5://127.0.0.1:9050 -f "bv[ext=mp4]+ba[ext=m4a]/b[ext=mp4]/b" --rm-cache-dir --no-warnings --no-mtime --no-part --no-embed-info-json --no-overwrites --no-abort-on-error --no-config --sponsorblock-mark all --sponsorblock-remove all --embed-thumbnail --embed-chapters --embed-metadata --ignore-errors --continue --retries 20 --retry-sleep exp=1:20 --download-archive "$HOME/archive.txt" --geo-bypass-country US --user-agent "Mozilla/5.0 (X11; Linux x86_64; rv:136.0) Gecko/20100101 Firefox/136.0" --sub-format "ass/srt/best" --write-subs --write-auto-sub --sub-lang "en,fr,ar,qsm" --convert-subs vtt --downloader "m3u8:native" --concurrent-fragments 5 --trim-filenames 150 --prefer-ffmpeg --downloader-args ffmpeg:"-loglevel error -stats -protocol_whitelist 'file,http,https,rtmp,rtmpe,rtmps,rtmpt,rtmpt,rtmpts,rtsp,hls,ftp,hls,mmst,mmsh' -timeout 10000000 -reconnect 1 -reconnect_streamed 1 -reconnect_delay_max 5" --merge-output-format mp4 --output "$HOME/Downloads/yt-dlp/video/yttor/%(title).255B.%(ext)s" < "$1"
